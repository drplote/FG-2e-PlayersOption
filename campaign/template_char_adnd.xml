<?xml version="1.0" encoding="iso-8859-1"?>
<root>

  <template name="actions_attack" merge="replace">
    <label>
      <rollable />
      <displaysign />
      <default>0</default>     
      <readonly />
      <cursor hover="hand" /> 
      <script>
        function onInit()
          OptionsManager.registerCallback(PlayerOptionManager.sAllowPlayerCheaterDice, initMenuItems);
          initMenuItems();
        end

        function initMenuItems()
        	RadialMenuManagerPO.initAttackMenu(self);
        end

        function onMenuSelection(selection, subselection)
        	RadialMenuManagerPO.onAttackMenuSelection(attackWithModifier, performChargeAction, selection, subselection);
        end

        function performChargeAction()
          local nodeWeapon = window.getDatabaseNode();
          local nodeChar = nodeWeapon.getChild("...")
          local nodeCT = CombatManager.getCTFromNode(nodeChar);
          EffectManager.addEffect("", "", nodeCT, { sName = "Charged", sLabel = "Charged", nDuration = 1 }, true);
          attackWithModifier();
        end

        function attackWithModifier(sModifierKey)
          if sModifierKey then
            ModifierStack.setModifierKey(sModifierKey, true);
          end
          window.onAttackAction();
        end

        function onHover(bOnControl)
          if bOnControl then
            setColor("#FFFFFF");
          else
            setColor(nil);
          end
        end

        function onDoubleClick(x,y)
          return window.onAttackAction();
        end      

        function onDragStart(button, x, y, draginfo)
          return window.onAttackAction(draginfo);
        end
      </script>
      <frame name="field-red" offset="5,6,5,6" />
      <tooltip textres="char_label_attack_tooltip" />
      <anchored height="20" width="25" >
        <top offset="4" />
        <left parent="leftanchor" anchor="right" relation="relative" offset="10" />
      </anchored>
      <center />
    </label>
  </template>

 </root>
